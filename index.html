<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Title</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="index_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="index_files/libs/quarto-html/anchor.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-236d90495073fb2ac8939117e3e83141.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="index_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="index_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="index_files/libs/bootstrap/bootstrap-de3a1749c61124d0c7456a0612b16043.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="index_files/libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="index_files/libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="index_files/libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#librairies" id="toc-librairies" class="nav-link active" data-scroll-target="#librairies"><span class="header-section-number">1</span> Librairies</a></li>
  <li><a href="#occurence-data" id="toc-occurence-data" class="nav-link" data-scroll-target="#occurence-data"><span class="header-section-number">2</span> Occurence data</a></li>
  <li><a href="#paleocoordinates" id="toc-paleocoordinates" class="nav-link" data-scroll-target="#paleocoordinates"><span class="header-section-number">3</span> Paleocoordinates</a></li>
  <li><a href="#exploratory-data-analysis" id="toc-exploratory-data-analysis" class="nav-link" data-scroll-target="#exploratory-data-analysis"><span class="header-section-number">4</span> Exploratory data analysis</a></li>
  <li><a href="#cells" id="toc-cells" class="nav-link" data-scroll-target="#cells"><span class="header-section-number">5</span> Cells</a></li>
  <li><a href="#biogeographic-connectedness" id="toc-biogeographic-connectedness" class="nav-link" data-scroll-target="#biogeographic-connectedness"><span class="header-section-number">6</span> Biogeographic connectedness</a></li>
  <li><a href="#spatial-binning" id="toc-spatial-binning" class="nav-link" data-scroll-target="#spatial-binning"><span class="header-section-number">7</span> Spatial binning</a></li>
  <li><a href="#subsampling-routine" id="toc-subsampling-routine" class="nav-link" data-scroll-target="#subsampling-routine"><span class="header-section-number">8</span> Subsampling routine</a></li>
  <li><a href="#jaccard-similarity" id="toc-jaccard-similarity" class="nav-link" data-scroll-target="#jaccard-similarity"><span class="header-section-number">9</span> Jaccard similarity</a></li>
  <li><a href="#great-circle-distance" id="toc-great-circle-distance" class="nav-link" data-scroll-target="#great-circle-distance"><span class="header-section-number">10</span> Great Circle Distance</a></li>
  <li><a href="#visualize-results" id="toc-visualize-results" class="nav-link" data-scroll-target="#visualize-results"><span class="header-section-number">11</span> Visualize results</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Title</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="librairies" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="librairies"><span class="header-section-number">1</span> Librairies</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>rpkg <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"dplyr ggplot2 readr boot divvy terra divDyn conflicted rgplates sf colorspace rgl</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="st">           icosa tidyr tibble purrr downloadthis ggpubr openxlsx"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>import_pkg <span class="ot">&lt;-</span> <span class="cf">function</span>(x)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> <span class="fu">trimws</span>() <span class="sc">|&gt;</span> <span class="fu">strsplit</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>)  <span class="sc">|&gt;</span> <span class="fu">unlist</span>() <span class="sc">|&gt;</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="cf">function</span>(x) <span class="fu">library</span>(x, <span class="at">character.only =</span> T)) <span class="sc">|&gt;</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>()</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>rpkg <span class="sc">|&gt;</span> <span class="fu">import_pkg</span>()</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Resolve conflicted functions.</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>conflicted<span class="sc">::</span><span class="fu">conflict_prefer</span>(<span class="at">name =</span> <span class="st">"filter"</span>, <span class="at">winner =</span> <span class="st">"dplyr"</span>,<span class="at">losers =</span> <span class="st">"stats"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="occurence-data" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="occurence-data"><span class="header-section-number">2</span> Occurence data</h2>
<p>Fossil occurrence data for Late Cretaceous (Campanian-Maastrichtian) and Paleocene (Danian-Thanetian) sharks were compiled using the primary literature and specimens from museum collections. Data processing mainly involved standardizing genus and species spelling. Unspecified species (i.e., sp) were not considered part of the analysis. We performed our analyses at both genus and species levels.The final cleaned occurrence dataset comprised <strong>X</strong> occurrences representing <strong>X</strong> species and <strong>X</strong> genera. Occurrence data were binned into chronostratigraphic ages.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Database.</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>Data <span class="ot">&lt;-</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read.xlsx</span>(<span class="at">xlsxFile =</span> <span class="st">"Data.xlsx"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>Duplicate <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"x"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>View <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"oblique labial"</span>,<span class="st">"oblique lingual"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Locale =</span> <span class="fu">as.factor</span>(Locale)) <span class="sc">|&gt;</span> </span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">as.factor</span>(Species)) <span class="sc">|&gt;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Synechodontiformes.</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">case_when</span>(Species <span class="sc">==</span> <span class="st">"Synechodus cf. faxensis"</span> <span class="sc">~</span> <span class="st">"Synechodus faxensis"</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Sphenodus cf. lundgreni"</span> <span class="sc">~</span> <span class="st">"Sphenodus lundgreni"</span>, <span class="cn">TRUE</span> <span class="sc">~</span> Species)) <span class="sc">|&gt;</span> </span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Heterodontiformes.</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">case_when</span>(Species <span class="sc">==</span> <span class="st">"Heterodontus granti nov. sp."</span> <span class="sc">~</span> <span class="st">"Heterodontus granti"</span>, <span class="cn">TRUE</span> <span class="sc">~</span> Species)) <span class="sc">|&gt;</span> </span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Squaliformes.</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">case_when</span>(Species <span class="sc">==</span> <span class="st">"Microetmopterus wardi gen. et sp. nov."</span> <span class="sc">~</span> <span class="st">"Microetmopterus wardi"</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Squalus gabrielsoni sp. nov."</span> <span class="sc">~</span> <span class="st">"Squalus gabrielsoni"</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Squalus huntensis nov. sp."</span> <span class="sc">~</span> <span class="st">"Squalus huntensis"</span>, </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Centrophoroides cf. appendiculatus"</span> <span class="sc">~</span> <span class="st">"Centrophoroides appendiculatus"</span>,<span class="cn">TRUE</span> <span class="sc">~</span> Species)) <span class="sc">|&gt;</span> </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Hexanchiformes.</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">case_when</span>(Species <span class="sc">==</span> <span class="st">"Heptranchias howellii"</span> <span class="sc">~</span> <span class="st">"Heptranchias howelli"</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Notidanodon brotzeni sp. nov."</span> <span class="sc">~</span> <span class="st">"Notidanodon brotzeni"</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Hexanchus aff. microdon"</span> <span class="sc">~</span> <span class="st">"Hexanchus microdon"</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Notidanodon cf. loozi"</span> <span class="sc">~</span> <span class="st">"Notidanodon loozi"</span>, <span class="cn">TRUE</span> <span class="sc">~</span> Species)) <span class="sc">|&gt;</span> </span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Orectolobiformes.</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">case_when</span>(Species <span class="sc">==</span> <span class="st">"Pararhincodon groessenssi"</span> <span class="sc">~</span> <span class="st">"Pararhincodon groessensi"</span>,</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Plicatoscyllium antiquum nov. gen. nov. sp."</span> <span class="sc">~</span> <span class="st">"Plicatoscyllium antiquum"</span>,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Plicatoscyllium cf globidens"</span> <span class="sc">~</span> <span class="st">"Plicatoscyllium globidens"</span>,</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Galagadon nordquistae n. gen. n. sp."</span> <span class="sc">~</span> <span class="st">"Galagadon nordquistae"</span>,</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Plicatoscyllium derameei nov. gen. nov. sp."</span>,<span class="st">"Plicatoscyllium deramei"</span>) <span class="sc">~</span> <span class="st">"Plicatoscyllium derameei"</span>,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cantioscyllium cf. meyeri "</span>,<span class="st">"Cantioscyllium aff. C. meyeri"</span>,<span class="st">"Cantioscyllium meyeri nov. sp."</span>) <span class="sc">~</span> <span class="st">"Cantioscyllium meyeri"</span>,<span class="cn">TRUE</span> <span class="sc">~</span> Species)) <span class="sc">|&gt;</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Lamniformes.</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">case_when</span>(Species <span class="sc">==</span> <span class="st">"Carcharias cf. C. holmdelensis"</span> <span class="sc">~</span> <span class="st">"Carcharias holmdelensis"</span>,</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Squalicorax africanus nov sp."</span> <span class="sc">~</span> <span class="st">"Squalicorax africanus"</span>,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Anomotodon noves"</span> <span class="sc">~</span> <span class="st">"Anomotodon novus"</span>,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Squalicorax bassanii "</span> <span class="sc">~</span> <span class="st">"Squalicorax bassanii"</span>,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Squalicorax pristodontus "</span>  <span class="sc">~</span> <span class="st">"Squalicorax pristodontus"</span>,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Squalicorax benguerirensis nov. sp."</span> <span class="sc">~</span> <span class="st">"Squalicorax benguerirensis"</span>,</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"speyeri"</span> <span class="sc">~</span> <span class="st">"Odontaspis speyeri"</span>,</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Odontaspis cf. winkleri"</span> <span class="sc">~</span> <span class="st">"Odontaspis winkleri"</span>,</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span>  <span class="st">"inflata"</span> <span class="sc">~</span> <span class="st">"Isurolamna inflata"</span>,</span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"obliquus"</span> <span class="sc">~</span> <span class="st">"Otodus obliquus"</span>,</span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Squalicorax microserratus nov. sp."</span> <span class="sc">~</span> <span class="st">"Squalicorax microserratus"</span>,</span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Cretolamna sp."</span> <span class="sc">~</span> <span class="st">"Cretalamna sp."</span>,</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Lamna cuspidata"</span> <span class="sc">~</span> <span class="st">"Carcharias cuspidatus"</span>, <span class="co"># Opinion of Hovestadt 2020.</span></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Carcharias macrotus"</span> <span class="sc">~</span> <span class="st">"Striatolamia macrota"</span>,</span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Odontaspis rutoti"</span> <span class="sc">~</span> <span class="st">"Palaeohypotodus rutoti"</span>,  <span class="co"># Opinion of Ebersole et al. 2024.</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Carcharodon orientalis"</span> <span class="sc">~</span> <span class="st">"Palaeocarcharodon orientalis"</span>,</span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Anomotodon hermani sp. nov."</span> <span class="sc">~</span> <span class="st">"Anomotodon hermani"</span>,</span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Squalicorax aff. S. lindstromi"</span> <span class="sc">~</span> <span class="st">"Squalicorax lindstromi"</span>,</span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Archaeolamna kopingensis"</span>  <span class="sc">~</span> <span class="st">"Archaeolamna kopingensis kopingensis"</span>,</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Lamna biauriculata nigeriana nov. sub sp."</span> <span class="sc">~</span> <span class="st">"Cretalamna nigeriana"</span>,</span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Cretalamna cf. C. borealis"</span> <span class="sc">~</span> <span class="st">"Cretalamna borealis"</span>,</span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Carcharias aff. C. tenuis"</span> ,<span class="st">"tenuis"</span>) <span class="sc">~</span> <span class="st">"Carcharias tenuis"</span>,</span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Squalicorax cf. S. yangaensis"</span>,<span class="st">"Squalicorax aff. S. yangaensis"</span>) <span class="sc">~</span> <span class="st">"Squalicorax yangaensis"</span>,</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Anomotodon aff. A. plicatus"</span>,<span class="st">"Anomotodon aff. plicatus"</span>) <span class="sc">~</span> <span class="st">"Anomotodon plicatus"</span>,</span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Odontaspis bronni"</span>,<span class="st">"Palaeohypotodus aff. bronni"</span>) <span class="sc">~</span> <span class="st">"Palaeohypotodus bronni"</span>,</span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cretalamna cf. C. biauriculata"</span>,<span class="st">"Cretolamna biauriculata"</span>) <span class="sc">~</span> <span class="st">"Cretalamna biauriculata"</span>,</span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cretolamna cf. C. maroccana"</span>,<span class="st">"Cretolamna maroccana"</span>) <span class="sc">~</span> <span class="st">"Cretalamna maroccana"</span>,</span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Carcharias aff. gracilis"</span>,<span class="st">"gracilis"</span>) <span class="sc">~</span> <span class="st">"Carcharias gracilis"</span>,</span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Striatolamia cederstroemi sp. nov."</span>,<span class="st">"cederstroemi"</span>) <span class="sc">~</span> <span class="st">"Striatolamia cederstroemi"</span>,</span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cretolamna appendiculata"</span>, <span class="st">"Cretolamna sp. aff. Cretolamna appendiculata"</span>,<span class="st">"Cretolamna cf. C. appendiculata"</span>) <span class="sc">~</span> <span class="st">"Cretalamna appendiculata"</span>,</span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Cretalamna cf. C. sarcoportheta"</span>,<span class="st">"Cretalamna sarcoportheta sp. nov."</span>) <span class="sc">~</span> <span class="st">"Cretalamna sarcoportheta"</span>,</span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Pseudocorax cf. P. affinis"</span>,<span class="st">"Pseudocorax cf. affinis"</span>) <span class="sc">~</span> <span class="st">"Pseudocorax affinis"</span>,</span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Anomotodon cf. A. toddi"</span>, <span class="st">"Anomotodon toddi nov. sp."</span>) <span class="sc">~</span> <span class="st">"Anomotodon toddi"</span>,</span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Carcharias cf. C. samhammeri"</span>, <span class="st">"Carcharias cf. samhammeri"</span>) <span class="sc">~</span> <span class="st">"Carcharias samhammeri"</span>,</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Carcharias cf. C. heathi"</span>, <span class="st">"Carcharias heathi nov. sp."</span>) <span class="sc">~</span> <span class="st">"Carcharias heathi"</span>,<span class="cn">TRUE</span> <span class="sc">~</span> Species)) <span class="sc">|&gt;</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Carcharhiniformes.</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">case_when</span>(Species <span class="sc">==</span> <span class="st">"Paratriakis tenuis sp. nov."</span> <span class="sc">~</span> <span class="st">"Paratriakis tenuis"</span>,</span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Palaeogaleus aff. faujasi"</span> <span class="sc">~</span> <span class="st">"Palaeogaleus faujasi"</span>,</span>
<span id="cb2-69"><a href="#cb2-69" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Galeorhinus gomphorhiza"</span> <span class="sc">~</span> <span class="st">"Khouribgaleus gomphorhiza"</span>,</span>
<span id="cb2-70"><a href="#cb2-70" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Scyliorhinus ivagrantae nov. sp."</span> <span class="sc">~</span> <span class="st">"Scyliorhinus ivagrantae"</span>,</span>
<span id="cb2-71"><a href="#cb2-71" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Squatigaleus grandjeani nov. sp."</span> <span class="sc">~</span> <span class="st">"Squatigaleus grandjeani"</span>,</span>
<span id="cb2-72"><a href="#cb2-72" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Squatigaleus carinatus nov. sp."</span> <span class="sc">~</span> <span class="st">"Squatigaleus carinatus"</span>,</span>
<span id="cb2-73"><a href="#cb2-73" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Scyliorhinus carinatus sp. nov."</span> <span class="sc">~</span> <span class="st">"Premontreia carinatus"</span>,</span>
<span id="cb2-74"><a href="#cb2-74" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Palaeogaleus navarroensis nov. sp."</span> <span class="sc">~</span> <span class="st">"Palaeogaleus navarroensis"</span>,</span>
<span id="cb2-75"><a href="#cb2-75" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Scyliorhinus aff. cabindensis"</span> <span class="sc">~</span> <span class="st">"Scyliorhinus cabindensis"</span>,</span>
<span id="cb2-76"><a href="#cb2-76" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">==</span> <span class="st">"Tingaleus dakkai n. gen. et nov. sp."</span> <span class="sc">~</span> <span class="st">"Tingaleus dakkai"</span>,</span>
<span id="cb2-77"><a href="#cb2-77" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Galeorhinus aff. girardoti"</span>,<span class="st">"Galeorhinus cf. G. girardoti"</span>) <span class="sc">~</span> <span class="st">"Galeorhinus girardoti"</span>,</span>
<span id="cb2-78"><a href="#cb2-78" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"indet."</span>,<span class="st">"Triakidae gen. et sp. indet."</span>) <span class="sc">~</span> <span class="cn">NA</span>,</span>
<span id="cb2-79"><a href="#cb2-79" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"‘Scyliorhinus’ biddlei"</span>, <span class="st">"“Scyliorhinus“ biddlei"</span>) <span class="sc">~</span> <span class="st">"Scyliorhinus biddlei"</span>,</span>
<span id="cb2-80"><a href="#cb2-80" aria-hidden="true" tabindex="-1"></a>                             Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"‘Scyliorhinus’ elongatus"</span>,<span class="st">"“Scyliorhinus” elongatus"</span>) <span class="sc">~</span>  <span class="st">"Scyliorhinus elongatus"</span>, T <span class="sc">~</span>  Species)) <span class="sc">|&gt;</span></span>
<span id="cb2-81"><a href="#cb2-81" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Correct family designation.</span></span>
<span id="cb2-82"><a href="#cb2-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Family =</span> <span class="fu">case_when</span>(Genus <span class="sc">==</span> <span class="st">"Palaeohypotodus"</span> <span class="sc">~</span> <span class="st">"Jaekelotodontidae"</span>, T <span class="sc">~</span> Family))</span>
<span id="cb2-83"><a href="#cb2-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-84"><a href="#cb2-84" aria-hidden="true" tabindex="-1"></a><span class="co"># 51 occurrences from the Limhamn quarry that needs to be ID.</span></span>
<span id="cb2-85"><a href="#cb2-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-86"><a href="#cb2-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove unspecified species.</span></span>
<span id="cb2-87"><a href="#cb2-87" aria-hidden="true" tabindex="-1"></a>remove_obs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Squalicorax sp."</span>,<span class="st">"Squalicorax nov. sp. 2"</span>,<span class="st">"Squalicorax nov. sp. 1"</span>,</span>
<span id="cb2-88"><a href="#cb2-88" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Scyliorhinus sp. 1"</span>,<span class="st">"Scyliorhinus sp. 2"</span>,<span class="st">"Scyliorhinus sp. 2"</span>, <span class="st">"Scyliorhinus sp. 1"</span>,</span>
<span id="cb2-89"><a href="#cb2-89" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Scapanorhynchus sp. 2"</span>,<span class="st">"Scapanorhynchus sp. 1"</span>,<span class="st">"Scapanorhynchus sp."</span>,<span class="st">"Protosqualus sp."</span>,</span>
<span id="cb2-90"><a href="#cb2-90" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Propristiophorus sp."</span>,<span class="st">"Plicatoscyllium sp."</span>,<span class="st">"Physogaleus sp."</span>,<span class="st">"Paratriakis sp."</span>,</span>
<span id="cb2-91"><a href="#cb2-91" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Pararhincodon sp."</span>,<span class="st">"Paraorthocodus sp."</span>,<span class="st">"Paraorthacodus sp."</span>, <span class="st">"Paranomotodon sp."</span>,</span>
<span id="cb2-92"><a href="#cb2-92" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Palaeogaleus sp. B"</span>,<span class="st">"Palaeogaleus sp."</span>,<span class="st">"Palaeobrachaelurus sp."</span>,<span class="st">"Odontaspis sp."</span> ,<span class="st">"Notorynchus sp."</span>,</span>
<span id="cb2-93"><a href="#cb2-93" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Notidanodon sp."</span>,<span class="st">"Nebrius sp."</span>,<span class="st">"Megasqualus sp."</span>,<span class="st">"Isurolamna sp."</span>,<span class="st">"Hexanchus spp."</span>,<span class="st">"Hexanchus sp."</span>,</span>
<span id="cb2-94"><a href="#cb2-94" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Heterodontus sp. 2"</span>, <span class="st">"Heterodontus sp."</span>,<span class="st">"Heptranchias sp."</span>,<span class="st">"Gladioserratus sp."</span>,<span class="st">"Ginglymostoma sp."</span>, </span>
<span id="cb2-95"><a href="#cb2-95" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Galeorhinus sp."</span>,<span class="st">"Foumtizia sp."</span>,<span class="st">"Echinorhinus sp."</span>,<span class="st">"Dalatias sp."</span>,<span class="st">"Cretalamna sp."</span>,<span class="st">"Cretalamna sp."</span>, </span>
<span id="cb2-96"><a href="#cb2-96" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Columbusia sp."</span>, <span class="st">"Chlamydoselachus sp."</span>,<span class="st">"Chiloscyllium sp."</span>,<span class="st">"Centrophorus sp."</span>, <span class="st">"Carcharias sp."</span>, <span class="st">"Brachycarcharias sp."</span>,</span>
<span id="cb2-97"><a href="#cb2-97" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Abdounia sp."</span>,<span class="st">"Woellsteinia sp."</span>,<span class="st">"Weltonia sp."</span>,<span class="st">"Triakis n. sp."</span>,<span class="st">"Squatina sp."</span>,<span class="st">"Squaliodalatias sp."</span>,</span>
<span id="cb2-98"><a href="#cb2-98" aria-hidden="true" tabindex="-1"></a>                <span class="st">"sp. nov."</span>,<span class="st">"sp. nov. A"</span>,<span class="st">"sp. nov. B"</span>, <span class="st">"Hemiscyllium sp."</span>)</span>
<span id="cb2-99"><a href="#cb2-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-100"><a href="#cb2-100" aria-hidden="true" tabindex="-1"></a>Data <span class="ot">&lt;-</span> Data <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="sc">!</span>Species <span class="sc">%in%</span> remove_obs) <span class="co"># Ask Mikael to provide IDs for all Limhamn specimens. But remove for now.</span></span>
<span id="cb2-101"><a href="#cb2-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-102"><a href="#cb2-102" aria-hidden="true" tabindex="-1"></a><span class="co"># Final subset (remove occurrences with no species identification)</span></span>
<span id="cb2-103"><a href="#cb2-103" aria-hidden="true" tabindex="-1"></a>Data <span class="ot">&lt;-</span></span>
<span id="cb2-104"><a href="#cb2-104" aria-hidden="true" tabindex="-1"></a>  Data <span class="sc">|&gt;</span> </span>
<span id="cb2-105"><a href="#cb2-105" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Species)) <span class="sc">|&gt;</span></span>
<span id="cb2-106"><a href="#cb2-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Age<span class="fl">.3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb2-107"><a href="#cb2-107" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove invalid taxa.</span></span>
<span id="cb2-108"><a href="#cb2-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>Species <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Palaeohypotodus rutori"</span>)) <span class="sc">|&gt;</span>  <span class="co"># Not valid according (Ebersole et al. 2024).</span></span>
<span id="cb2-109"><a href="#cb2-109" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Final corrections.</span></span>
<span id="cb2-110"><a href="#cb2-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Genus =</span> <span class="fu">case_when</span>(Genus <span class="sc">==</span> <span class="st">"Cretolamna"</span> <span class="sc">~</span> <span class="st">"Cretalamna"</span>,<span class="cn">TRUE</span> <span class="sc">~</span> Genus)) <span class="sc">|&gt;</span> </span>
<span id="cb2-111"><a href="#cb2-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">case_when</span>(Species <span class="sc">==</span> <span class="st">"Isurolamna inflata"</span> <span class="sc">~</span> <span class="st">"Isurolamna affinis"</span>, T <span class="sc">~</span> Species)</span>
<span id="cb2-112"><a href="#cb2-112" aria-hidden="true" tabindex="-1"></a>         ) <span class="sc">|&gt;</span>  <span class="co"># (see Popov and Vladimir A. Lopyrev 2024).</span></span>
<span id="cb2-113"><a href="#cb2-113" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb2-114"><a href="#cb2-114" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove columns.</span></span>
<span id="cb2-115"><a href="#cb2-115" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">"Used"</span>,<span class="st">"Duplicate"</span>,<span class="st">"Not_Digitized"</span>)) <span class="co"># 2197 occurrences with species names.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="paleocoordinates" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="paleocoordinates"><span class="header-section-number">3</span> Paleocoordinates</h2>
<p>We used the present-day coordinates (i.e.&nbsp;latitude and longitude) of fossil localities/areas to reconstruct their corresponding paleocoordinates. This was achieved using the <code>rgplates</code> v. 0.6.0 R package and we opted to use the midpoint of each chronostratigraphic intervals.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>age_split <span class="ot">&lt;-</span> <span class="fu">group_split</span>(Data <span class="sc">|&gt;</span> <span class="fu">group_by</span>(Age<span class="fl">.3</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Paleocoordinates.</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>campan_coords <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(<span class="at">x =</span> age_split[[<span class="dv">1</span>]][,<span class="dv">19</span><span class="sc">:</span><span class="dv">20</span>] <span class="sc">|&gt;</span> <span class="fu">relocate</span>(Latitude,<span class="at">.after =</span> <span class="st">"Longitude"</span>),<span class="at">age =</span> <span class="fl">77.75</span>) <span class="co"># Campanian</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>maastr_coords <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(<span class="at">x =</span> age_split[[<span class="dv">3</span>]][,<span class="dv">19</span><span class="sc">:</span><span class="dv">20</span>] <span class="sc">|&gt;</span> <span class="fu">relocate</span>(Latitude,<span class="at">.after =</span> <span class="st">"Longitude"</span>),<span class="at">age =</span> <span class="dv">69</span>)    <span class="co"># Maastrichtian</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>danian_coords <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(<span class="at">x =</span> age_split[[<span class="dv">2</span>]][,<span class="dv">19</span><span class="sc">:</span><span class="dv">20</span>] <span class="sc">|&gt;</span> <span class="fu">relocate</span>(Latitude,<span class="at">.after =</span> <span class="st">"Longitude"</span>),<span class="at">age =</span> <span class="fl">62.5</span>)  <span class="co"># Danian-Selandian.</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>thanet_coords <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(<span class="at">x =</span> age_split[[<span class="dv">4</span>]][,<span class="dv">19</span><span class="sc">:</span><span class="dv">20</span>] <span class="sc">|&gt;</span> <span class="fu">relocate</span>(Latitude,<span class="at">.after =</span> <span class="st">"Longitude"</span>),<span class="at">age =</span> <span class="fl">57.5</span>)  <span class="co"># Thanetian</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Append paleocoordinates.</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>spatial_data <span class="ot">&lt;-</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(age_split[[<span class="dv">1</span>]],campan_coords),</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(age_split[[<span class="dv">3</span>]],maastr_coords),</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(age_split[[<span class="dv">2</span>]],danian_coords),</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(age_split[[<span class="dv">4</span>]],thanet_coords)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add numeric stage variable.</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stg =</span> <span class="cn">NULL</span>) <span class="sc">|&gt;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stg =</span> <span class="fu">case_when</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"Campanian"</span> <span class="sc">~</span> <span class="st">"80"</span>,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>                         Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"Maastrichtian"</span> <span class="sc">~</span> <span class="st">"81"</span>,</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>                         Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"DanSelCombined"</span> <span class="sc">~</span> <span class="st">"82"</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>                         Age<span class="fl">.3</span> <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Thanetian"</span>) <span class="sc">~</span> <span class="st">"83"</span>,T <span class="sc">~</span> Age<span class="fl">.3</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">stg =</span> <span class="fu">as.numeric</span>(stg))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exploratory-data-analysis" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="exploratory-data-analysis"><span class="header-section-number">4</span> Exploratory data analysis</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of occurrences by country.</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>spatial_data <span class="sc">|&gt;</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">case_when</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"DanSelCombined"</span> <span class="sc">~</span> <span class="st">"Danian-Selandian"</span>, T <span class="sc">~</span> Age<span class="fl">.3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">factor</span>(Age<span class="fl">.3</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Campanian"</span>,<span class="st">"Maastrichtian"</span>,<span class="st">"Danian-Selandian"</span>,<span class="st">"Thanetian"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Country,Age<span class="fl">.3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">|&gt;</span> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Country, <span class="at">y =</span> n, <span class="at">fill =</span> Age<span class="fl">.3</span>)) <span class="sc">+</span> </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_manual(values = qualitative_hcl(4, palette = "Dark 3")) +</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span>   <span class="fu">c</span>(<span class="st">"#C1C6CFFF"</span>,<span class="st">"#180C18FF"</span>,<span class="st">"#933450FF"</span>,<span class="st">"#D99755FF"</span>)) <span class="sc">+</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#C1C6CFFF"</span>,<span class="st">"#180C18FF"</span>,<span class="st">"#933450FF"</span>,<span class="st">"#D99755FF"</span>)) <span class="sc">+</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Number of Occurrences"</span>, <span class="at">fill =</span> <span class="st">"Chronostratigraphic age"</span>) <span class="sc">+</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid=</span><span class="fu">element_line</span>(<span class="at">linetype=</span><span class="dv">3</span>,<span class="at">linewidth=</span><span class="fl">0.2</span>, </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>                                <span class="at">color=</span><span class="st">'gray50'</span>),</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(),</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background=</span><span class="fu">element_blank</span>(),</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-4-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of occurrences by source.</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>spatial_data <span class="sc">|&gt;</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">case_when</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"DanSelCombined"</span> <span class="sc">~</span> <span class="st">"Danian-Selandian"</span>, T <span class="sc">~</span> Age<span class="fl">.3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">factor</span>(Age<span class="fl">.3</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Campanian"</span>,<span class="st">"Maastrichtian"</span>,<span class="st">"Danian-Selandian"</span>,<span class="st">"Thanetian"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Source,Age<span class="fl">.3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">|&gt;</span> </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Source, <span class="at">y =</span> n, <span class="at">fill =</span> Age<span class="fl">.3</span>)) <span class="sc">+</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_manual(values = qualitative_hcl(4, palette = "Dark 3")) +</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span>   <span class="fu">c</span>(<span class="st">"#C1C6CFFF"</span>,<span class="st">"#180C18FF"</span>,<span class="st">"#933450FF"</span>,<span class="st">"#D99755FF"</span>)) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#C1C6CFFF"</span>,<span class="st">"#180C18FF"</span>,<span class="st">"#933450FF"</span>,<span class="st">"#D99755FF"</span>)) <span class="sc">+</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Occurrences"</span>, <span class="at">fill =</span> <span class="st">"Chronostratigraphic age"</span>) <span class="sc">+</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid=</span><span class="fu">element_line</span>(<span class="at">linetype=</span><span class="dv">3</span>,<span class="at">linewidth=</span><span class="fl">0.2</span>, </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                                <span class="at">color=</span><span class="st">'gray50'</span>),</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(),</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background=</span><span class="fu">element_blank</span>(),</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="dv">1</span>,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text  =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-4-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="index_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of occurrences by order.</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>spatial_data <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">case_when</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"DanSelCombined"</span> <span class="sc">~</span> <span class="st">"Danian-Selandian"</span>, T <span class="sc">~</span> Age<span class="fl">.3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">factor</span>(Age<span class="fl">.3</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Campanian"</span>,<span class="st">"Maastrichtian"</span>,<span class="st">"Danian-Selandian"</span>,<span class="st">"Thanetian"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Order,Age<span class="fl">.3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">|&gt;</span> </span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Order, <span class="at">y =</span> n, <span class="at">fill =</span> Order)) <span class="sc">+</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Sample Size"</span>) <span class="sc">+</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span> Age<span class="fl">.3</span>, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>,<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-4-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="index_files/figure-html/unnamed-chunk-4-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of occurrences by species (divide into two plots)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>spatial_data <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Superorder <span class="sc">==</span> <span class="st">"Galeomorphii"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Order <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Lamniformes"</span>,<span class="st">"Carcharhiniformes"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">case_when</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"DanSelCombined"</span> <span class="sc">~</span> <span class="st">"Danian-Selandian"</span>, T <span class="sc">~</span> Age<span class="fl">.3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">factor</span>(Age<span class="fl">.3</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Campanian"</span>,<span class="st">"Maastrichtian"</span>,<span class="st">"Danian-Selandian"</span>,<span class="st">"Thanetian"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Order =</span> <span class="fu">factor</span>(Order, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Lamniformes"</span>,<span class="st">"Carcharhiniformes"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Species,Order,Age<span class="fl">.3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">|&gt;</span> </span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> n, <span class="at">fill =</span> Age<span class="fl">.3</span>)) <span class="sc">+</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span>   <span class="fu">c</span>(<span class="st">"#C1C6CFFF"</span>,<span class="st">"#180C18FF"</span>,<span class="st">"#933450FF"</span>,<span class="st">"#D99755FF"</span>)) <span class="sc">+</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#C1C6CFFF"</span>,<span class="st">"#180C18FF"</span>,<span class="st">"#933450FF"</span>,<span class="st">"#D99755FF"</span>)) <span class="sc">+</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Sample Size"</span>, <span class="at">fill =</span> <span class="st">"Chronostratigraphic age"</span>) <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span> Order, <span class="at">scales =</span> <span class="st">"free"</span>,<span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>,<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"italic"</span>),</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-4-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="index_files/figure-html/unnamed-chunk-4-4.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>spatial_data <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Superorder <span class="sc">==</span> <span class="st">"Squalomorphii"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>Order <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Lamniformes"</span>,<span class="st">"Carcharhiniformes"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">case_when</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"DanSelCombined"</span> <span class="sc">~</span> <span class="st">"Danian-Selandian"</span>, T <span class="sc">~</span> Age<span class="fl">.3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">factor</span>(Age<span class="fl">.3</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Campanian"</span>,<span class="st">"Maastrichtian"</span>,<span class="st">"Danian-Selandian"</span>,<span class="st">"Thanetian"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Species,Order,Age<span class="fl">.3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">|&gt;</span> </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> Species, <span class="at">y =</span> n, <span class="at">fill =</span> Age<span class="fl">.3</span>)) <span class="sc">+</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span>   <span class="fu">c</span>(<span class="st">"#C1C6CFFF"</span>,<span class="st">"#180C18FF"</span>,<span class="st">"#933450FF"</span>,<span class="st">"#D99755FF"</span>)) <span class="sc">+</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#C1C6CFFF"</span>,<span class="st">"#180C18FF"</span>,<span class="st">"#933450FF"</span>,<span class="st">"#D99755FF"</span>)) <span class="sc">+</span>  </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Sample Size"</span>) <span class="sc">+</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span> Order, <span class="at">scales =</span> <span class="st">"free"</span>,<span class="at">ncol =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>,<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"italic"</span>),</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>,<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">6</span>),</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-4-5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5"><img src="index_files/figure-html/unnamed-chunk-4-5.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<p>Two questions are being asked:</p>
<ol type="1">
<li>How did the spatial structuring in community similarity change across the Maastrichtian-Danian boundary?</li>
<li>Turnover rates.</li>
</ol>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>species_list <span class="ot">&lt;-</span> </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  spatial_data <span class="sc">|&gt;</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">factor</span>(Age<span class="fl">.3</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Campanian"</span>,<span class="st">"Maastrichtian"</span>,<span class="st">"Danian-Selandian"</span>,<span class="st">"Thanetian"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Age<span class="fl">.3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Species =</span> <span class="fu">list</span>(<span class="fu">unique</span>(Species))) <span class="sc">|&gt;</span> </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(Species)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(species_list) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Campanian"</span>,<span class="st">"Maastrichtian"</span>,<span class="st">"Danian-Selandian"</span>,<span class="st">"Thanetian"</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Campanian versus Maastrichtian.</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(generics<span class="sc">::</span><span class="fu">intersect</span>(<span class="at">x =</span> species_list<span class="sc">$</span>Campanian,<span class="at">y =</span> species_list<span class="sc">$</span>Maastrichtian))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Campanian versus Danian-Selandian.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(generics<span class="sc">::</span><span class="fu">intersect</span>(<span class="at">x =</span> species_list<span class="sc">$</span>Campanian,<span class="at">y =</span> species_list<span class="sc">$</span><span class="st">`</span><span class="at">Danian-Selandian</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Campanian versus Thanetian.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(generics<span class="sc">::</span><span class="fu">intersect</span>(<span class="at">x =</span> species_list<span class="sc">$</span>Campanian,<span class="at">y =</span> species_list<span class="sc">$</span>Thanetian))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Maastrichtian versus Danian-Selandian</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(generics<span class="sc">::</span><span class="fu">intersect</span>(<span class="at">x =</span> species_list<span class="sc">$</span>Maastrichtian,<span class="at">y =</span> species_list<span class="sc">$</span><span class="st">`</span><span class="at">Danian-Selandian</span><span class="st">`</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Maastrichtian versus Thanetian</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(generics<span class="sc">::</span><span class="fu">intersect</span>(<span class="at">x =</span> species_list<span class="sc">$</span>Maastrichtian,<span class="at">y =</span> species_list<span class="sc">$</span>Thanetian))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Danian-Selandian versus Thanetian</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(generics<span class="sc">::</span><span class="fu">intersect</span>(<span class="at">x =</span> species_list<span class="sc">$</span><span class="st">`</span><span class="at">Danian-Selandian</span><span class="st">`</span>,<span class="at">y =</span> species_list<span class="sc">$</span>Thanetian))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9</code></pre>
</div>
</div>
</section>
<section id="cells" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="cells"><span class="header-section-number">5</span> Cells</h2>
<p>We first assigned fossil occurrences to equal-area spatial grid cells and retained only those with sufficient sampling (i.e., at a minimum occurrence-level of 20). First, the occurrence data were filtered to include only records from a specified geologic time-interval. Each occurrence was then assigned to a spatial grid cell using the <code>icosa v. 0.11.1</code> R package and a pre-defined hexagonal equal-area grid object. We calculated the number of occurrences per cell and retained only those with at least a minimum number of records to reduce the influence of undersampled areas. Finally, we extracted the geographic centroids of the retained cells and merged this information back into the dataset to support downstream spatial analysis.</p>
<p>At a minimum occurrences of 15, the interval with least number of cells is the Thanetian.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up the grid,</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>hexa <span class="ot">&lt;-</span> <span class="fu">hexagrid</span>(<span class="at">deg =</span> <span class="fl">3.5</span>, <span class="at">sf =</span> <span class="cn">TRUE</span>) <span class="co"># The mean grid edge length is 403.97 km or 3.63 degrees.</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>clean_spatial_data <span class="ot">&lt;-</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rbind</span>(</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Campanian.</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  spatial_data <span class="sc">|&gt;</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"Campanian"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cell =</span> <span class="fu">locate</span>(<span class="at">x =</span> hexa,<span class="at">y =</span> spatial_data[spatial_data<span class="sc">$</span>Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"Campanian"</span>,] <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="st">"paleolong"</span>, <span class="st">"paleolat"</span>))),</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Maastrichtian.</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  spatial_data <span class="sc">|&gt;</span> </span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"Maastrichtian"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cell =</span> <span class="fu">locate</span>(<span class="at">x =</span> hexa,<span class="at">y =</span> spatial_data[spatial_data<span class="sc">$</span>Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"Maastrichtian"</span>,] <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="st">"paleolong"</span>, <span class="st">"paleolat"</span>))), </span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Danian/Selandian.</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  spatial_data <span class="sc">|&gt;</span> </span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"DanSelCombined"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cell =</span> <span class="fu">locate</span>(<span class="at">x =</span> hexa,<span class="at">y =</span> spatial_data[spatial_data<span class="sc">$</span>Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"DanSelCombined"</span>,] <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="st">"paleolong"</span>, <span class="st">"paleolat"</span>))),</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Thanetian.</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>  spatial_data <span class="sc">|&gt;</span> </span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"Thanetian"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cell =</span> <span class="fu">locate</span>(<span class="at">x =</span> hexa,<span class="at">y =</span> spatial_data[spatial_data<span class="sc">$</span>Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"Thanetian"</span>,] <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="st">"paleolong"</span>, <span class="st">"paleolat"</span>)))</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Count occurrences per cell and age.</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>clean_spatial_data <span class="sc">|&gt;</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">case_when</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"DanSelCombined"</span> <span class="sc">~</span> <span class="st">"Danian-Selandian"</span>, T <span class="sc">~</span> Age<span class="fl">.3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">factor</span>(Age<span class="fl">.3</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Campanian"</span>,<span class="st">"Maastrichtian"</span>,<span class="st">"Danian-Selandian"</span>,<span class="st">"Thanetian"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cell,Age<span class="fl">.3</span>) <span class="sc">|&gt;</span> <span class="fu">count</span>() <span class="sc">|&gt;</span> </span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cell, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>Age<span class="fl">.3</span>,<span class="at">scales =</span> <span class="st">"free"</span>,<span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">1.5</span>,</span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid=</span><span class="fu">element_line</span>(<span class="at">linetype=</span><span class="dv">3</span>,<span class="at">linewidth=</span><span class="fl">0.2</span>),</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(),</span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background=</span><span class="fu">element_blank</span>(),</span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>)</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-6-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="index_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter.</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>clean_spatial_data <span class="sc">|&gt;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">case_when</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"DanSelCombined"</span> <span class="sc">~</span> <span class="st">"Danian-Selandian"</span>, T <span class="sc">~</span> Age<span class="fl">.3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">factor</span>(Age<span class="fl">.3</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Campanian"</span>,<span class="st">"Maastrichtian"</span>,<span class="st">"Danian-Selandian"</span>,<span class="st">"Thanetian"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cell,Age<span class="fl">.3</span>) <span class="sc">|&gt;</span> <span class="fu">count</span>() <span class="sc">|&gt;</span> </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">|&gt;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n <span class="sc">&gt;=</span> <span class="dv">15</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cell, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">15</span>,<span class="at">colour =</span> <span class="st">"#D83853"</span>) <span class="sc">+</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Number of occurrences"</span>) <span class="sc">+</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>Age<span class="fl">.3</span>,<span class="at">scales =</span> <span class="st">"free"</span>,<span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">1.5</span>,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid=</span><span class="fu">element_line</span>(<span class="at">linetype=</span><span class="dv">3</span>,<span class="at">linewidth=</span><span class="fl">0.2</span>, </span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>                                <span class="at">color=</span><span class="st">'#53565A'</span>),</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(),</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background=</span><span class="fu">element_blank</span>(),</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>)</span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-6-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7"><img src="index_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function used to filter, spatially bin, and enriching the data with cell metadata.</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>cell_preparation <span class="ot">&lt;-</span> <span class="cf">function</span>(data,age,hexa,<span class="at">min_occ =</span> <span class="cn">NULL</span>) {</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Subset by age.</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">filter</span>(Age<span class="fl">.3</span> <span class="sc">==</span> age)</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign cell-units based on the coordinates.</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">cell =</span> icosa<span class="sc">::</span><span class="fu">locate</span>(<span class="at">x =</span> hexa,<span class="at">y =</span> data <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="st">"paleolong"</span>,<span class="st">"paleolat"</span>)))</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Count occurrences per cell and filter by minimum occurrence.</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> </span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>    data <span class="sc">|&gt;</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cell) <span class="sc">|&gt;</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">occs =</span> <span class="fu">n</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(occs <span class="sc">&gt;=</span> min_occ)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Retained cells.</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>  cells_to_keep <span class="ot">&lt;-</span> <span class="fu">unique</span>(data<span class="sc">$</span>cell)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>  cell_centroids <span class="ot">&lt;-</span> </span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>(<span class="fu">centers</span>(hexa))[cells_to_keep, , drop <span class="ot">=</span> <span class="cn">FALSE</span>] <span class="sc">|&gt;</span></span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"cell"</span>)</span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Merge centroid-value.</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span> <span class="fu">left_join</span>(cell_centroids, <span class="at">by =</span> <span class="st">"cell"</span>)</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Cell assignment and remove occurrence below the minimum thresh-hold.</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>campanian_cells <span class="ot">&lt;-</span> <span class="fu">cell_preparation</span>(<span class="at">data =</span> clean_spatial_data,<span class="at">age =</span> <span class="st">"Campanian"</span>,<span class="at">hexa =</span> hexa, <span class="at">min_occ =</span> <span class="dv">15</span>)</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>maastrich_cells <span class="ot">&lt;-</span> <span class="fu">cell_preparation</span>(<span class="at">data =</span> clean_spatial_data,<span class="at">age =</span> <span class="st">"Maastrichtian"</span>,<span class="at">hexa =</span> hexa,<span class="at">min_occ =</span> <span class="dv">15</span>) </span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>daniansel_cells <span class="ot">&lt;-</span> <span class="fu">cell_preparation</span>(<span class="at">data =</span> clean_spatial_data,<span class="at">age =</span> <span class="st">"DanSelCombined"</span>,<span class="at">hexa =</span> hexa,<span class="at">min_occ =</span> <span class="dv">15</span>)</span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>thanetian_cells <span class="ot">&lt;-</span> <span class="fu">cell_preparation</span>(<span class="at">data =</span> clean_spatial_data,<span class="at">age =</span> <span class="st">"Thanetian"</span>,<span class="at">hexa =</span> hexa,<span class="at">min_occ =</span> <span class="dv">15</span>)</span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all data subsets.</span></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>clean_spatial_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(campanian_cells,maastrich_cells,daniansel_cells,thanetian_cells) <span class="co"># 2053 specimens in total.</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Create unique identifier for each cell.</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>clean_spatial_data <span class="ot">&lt;-</span></span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="fu">unique</span>(clean_spatial_data<span class="sc">$</span>cell)) <span class="sc">|&gt;</span> <span class="co"># 23 unique cells.</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="at">nm =</span> <span class="st">"cell"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cell_id =</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(cell))) <span class="sc">|&gt;</span> </span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">inner_join</span>(clean_spatial_data, </span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>             <span class="at">by =</span> <span class="st">"cell"</span>)</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect.</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>clean_spatial_data <span class="sc">|&gt;</span></span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">case_when</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"DanSelCombined"</span> <span class="sc">~</span> <span class="st">"Danian-Selandian"</span>, T <span class="sc">~</span> Age<span class="fl">.3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">factor</span>(Age<span class="fl">.3</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Campanian"</span>,<span class="st">"Maastrichtian"</span>,<span class="st">"Danian-Selandian"</span>,<span class="st">"Thanetian"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cell,Age<span class="fl">.3</span>) <span class="sc">|&gt;</span> <span class="fu">count</span>() <span class="sc">|&gt;</span> </span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cell, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">15</span>,<span class="at">colour =</span> <span class="st">"#D83853"</span>) <span class="sc">+</span></span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Number of occurrences"</span>) <span class="sc">+</span></span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>Age<span class="fl">.3</span>,<span class="at">scales =</span> <span class="st">"free"</span>,<span class="at">nrow =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">1.5</span>,</span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid=</span><span class="fu">element_line</span>(<span class="at">linetype=</span><span class="dv">3</span>,<span class="at">linewidth=</span><span class="fl">0.2</span>, </span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>                                <span class="at">color=</span><span class="st">'#53565A'</span>),</span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(),</span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background=</span><span class="fu">element_blank</span>(),</span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>)</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-6-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8"><img src="index_files/figure-html/unnamed-chunk-6-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of species per age.</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>clean_spatial_data <span class="sc">|&gt;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">case_when</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"DanSelCombined"</span> <span class="sc">~</span> <span class="st">"Danian-Selandian"</span>, T <span class="sc">~</span> Age<span class="fl">.3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">factor</span>(Age<span class="fl">.3</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Campanian"</span>,<span class="st">"Maastrichtian"</span>,<span class="st">"Danian-Selandian"</span>,<span class="st">"Thanetian"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Age<span class="fl">.3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n_distinct</span>(Species)) <span class="sc">|&gt;</span> </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Age<span class="fl">.3</span>, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>, <span class="at">y =</span> <span class="st">"Number of species"</span>) <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">1.5</span>,</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid=</span><span class="fu">element_line</span>(<span class="at">linetype=</span><span class="dv">3</span>,<span class="at">linewidth=</span><span class="fl">0.2</span>, </span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>                                <span class="at">color=</span><span class="st">'#53565A'</span>),</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(),</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background=</span><span class="fu">element_blank</span>(),</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>),</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">hjust =</span> <span class="dv">1</span>,<span class="at">vjust =</span> <span class="dv">1</span>)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-6-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9"><img src="index_files/figure-html/unnamed-chunk-6-4.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of genera per age.</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>clean_spatial_data <span class="sc">|&gt;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">case_when</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"DanSelCombined"</span> <span class="sc">~</span> <span class="st">"Danian-Selandian"</span>, T <span class="sc">~</span> Age<span class="fl">.3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">factor</span>(Age<span class="fl">.3</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Campanian"</span>,<span class="st">"Maastrichtian"</span>,<span class="st">"Danian-Selandian"</span>,<span class="st">"Thanetian"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Age<span class="fl">.3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n_distinct</span>(Genus)) <span class="sc">|&gt;</span> </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Age<span class="fl">.3</span>, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Age"</span>, <span class="at">y =</span> <span class="st">"Number of genera"</span>) <span class="sc">+</span></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">aspect.ratio =</span> <span class="fl">1.5</span>,</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid=</span><span class="fu">element_line</span>(<span class="at">linetype=</span><span class="dv">3</span>,<span class="at">linewidth=</span><span class="fl">0.2</span>, </span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>                                <span class="at">color=</span><span class="st">'#53565A'</span>),</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor=</span><span class="fu">element_blank</span>(),</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.background=</span><span class="fu">element_blank</span>(),</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text=</span><span class="fu">element_text</span>(<span class="at">hjust=</span><span class="dv">0</span>),</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>,<span class="at">hjust =</span> <span class="dv">1</span>,<span class="at">vjust =</span> <span class="dv">1</span>)</span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>        )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-6-5.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10"><img src="index_files/figure-html/unnamed-chunk-6-5.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="biogeographic-connectedness" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="biogeographic-connectedness"><span class="header-section-number">6</span> Biogeographic connectedness</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function.</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>BC <span class="ot">&lt;-</span> <span class="cf">function</span>(taxon_unit, sites) {</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  O <span class="ot">&lt;-</span> <span class="fu">length</span>(taxon_unit)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  N <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(taxon_unit))</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  L <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(sites))</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>((O<span class="sc">-</span>N)<span class="sc">/</span>((L<span class="sc">*</span>N)<span class="sc">-</span>N))</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>clean_spatial_data <span class="sc">|&gt;</span> </span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">case_when</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"DanSelCombined"</span> <span class="sc">~</span> <span class="st">"Danian-Selandian"</span>, T <span class="sc">~</span> Age<span class="fl">.3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">factor</span>(Age<span class="fl">.3</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Campanian"</span>,<span class="st">"Maastrichtian"</span>,<span class="st">"Danian-Selandian"</span>,<span class="st">"Thanetian"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Age<span class="fl">.3</span>) <span class="sc">|&gt;</span> </span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">BC =</span> <span class="fu">BC</span>(Species, cell),</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">count_occurrences =</span> <span class="fu">n</span>(),</span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">count_unique_species =</span> <span class="fu">n_distinct</span>(Species)</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Visualize:</span></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Age<span class="fl">.3</span>, <span class="at">y =</span> BC, <span class="at">fill =</span> Age<span class="fl">.3</span>)) <span class="sc">+</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span>   <span class="fu">c</span>(<span class="st">"#C1C6CFFF"</span>,<span class="st">"#180C18FF"</span>,<span class="st">"#933450FF"</span>,<span class="st">"#D99755FF"</span>)) <span class="sc">+</span></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#C1C6CFFF"</span>,<span class="st">"#180C18FF"</span>,<span class="st">"#933450FF"</span>,<span class="st">"#D99755FF"</span>)) <span class="sc">+</span>  </span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>,<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-7-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-11"><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="spatial-binning" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="spatial-binning"><span class="header-section-number">7</span> Spatial binning</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(<span class="fu">file.path</span>(<span class="fu">system.file</span>(<span class="at">package=</span><span class="st">"rgplates"</span>), <span class="st">"extdata/paleomap_v3.zip"</span>), <span class="at">exdir=</span><span class="fu">tempdir</span>())</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>pathToPolygons  <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">"PALEOMAP_PlatePolygons.gpml"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>pathToRotations <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="fu">tempdir</span>(), <span class="st">"PALEOMAP_PlateModel.rot"</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>pm <span class="ot">&lt;-</span> <span class="fu">platemodel</span>(</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">features =</span> <span class="fu">c</span>(<span class="st">"static_polygons"</span> <span class="ot">=</span> pathToPolygons),</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">rotation =</span> pathToRotations</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot.</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>plates_campanian <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(<span class="st">"static_polygons"</span>, <span class="at">age=</span> <span class="fl">77.75</span>, <span class="at">model =</span>pm)  <span class="co"># Campanian</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>plates_maastrichtian <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(<span class="st">"static_polygons"</span>, <span class="at">age=</span> <span class="dv">69</span>, <span class="at">model =</span>pm) <span class="co"># Maastrichtian</span></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>plates_danian <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(<span class="st">"static_polygons"</span>, <span class="at">age=</span> <span class="fl">62.5</span>, <span class="at">model =</span>pm)      <span class="co"># Danian</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>plates_thanetian <span class="ot">&lt;-</span> <span class="fu">reconstruct</span>(<span class="st">"static_polygons"</span>, <span class="at">age=</span> <span class="fl">57.5</span>, <span class="at">model =</span>pm)   <span class="co"># Thanetian</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform plates to Mollweide projection.</span></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Campanian.</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hexa,<span class="fu">table</span>(clean_spatial_data[clean_spatial_data<span class="sc">$</span>Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"Campanian"</span>,]<span class="sc">$</span>cell),</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">crs =</span><span class="st">"ESRI:54009"</span>,</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">"#53565A"</span>,</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>     <span class="at">reset=</span><span class="cn">FALSE</span>)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf<span class="sc">::</span><span class="fu">st_transform</span>(plates_campanian, <span class="st">"ESRI:54009"</span>)<span class="sc">$</span>geometry, <span class="at">add =</span> <span class="cn">TRUE</span>,<span class="at">border=</span> <span class="cn">NA</span>, <span class="at">col =</span> <span class="st">"#66666688"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-8-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-12"><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Maastrichtian.</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hexa,<span class="fu">table</span>(clean_spatial_data[clean_spatial_data<span class="sc">$</span>Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"Maastrichtian"</span>,]<span class="sc">$</span>cell),</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">crs =</span><span class="st">"ESRI:54009"</span>,</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">"#53565A"</span>,</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">reset=</span><span class="cn">FALSE</span>)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf<span class="sc">::</span><span class="fu">st_transform</span>(plates_maastrichtian, <span class="st">"ESRI:54009"</span>)<span class="sc">$</span>geometry, <span class="at">add =</span> <span class="cn">TRUE</span>,<span class="at">border=</span> <span class="cn">NA</span>, <span class="at">col =</span> <span class="st">"#66666688"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-8-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-13"><img src="index_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Danian-Selandian.</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hexa,<span class="fu">table</span>(clean_spatial_data[clean_spatial_data<span class="sc">$</span>Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"DanSelCombined"</span>,]<span class="sc">$</span>cell),</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">crs =</span><span class="st">"ESRI:54009"</span>,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">"#53565A"</span>,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">reset=</span><span class="cn">FALSE</span>)</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf<span class="sc">::</span><span class="fu">st_transform</span>(plates_danian, <span class="st">"ESRI:54009"</span>)<span class="sc">$</span>geometry, <span class="at">add =</span> <span class="cn">TRUE</span>,<span class="at">border=</span> <span class="cn">NA</span>, <span class="at">col =</span> <span class="st">"#66666688"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-8-3.png" class="lightbox" data-gallery="quarto-lightbox-gallery-14"><img src="index_files/figure-html/unnamed-chunk-8-3.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Thanetian.</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(hexa,<span class="fu">table</span>(clean_spatial_data[clean_spatial_data<span class="sc">$</span>Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"Thanetian"</span>,]<span class="sc">$</span>cell),</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">crs =</span><span class="st">"ESRI:54009"</span>,</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">border =</span> <span class="st">"#53565A"</span>,</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">reset=</span><span class="cn">FALSE</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(sf<span class="sc">::</span><span class="fu">st_transform</span>(plates_thanetian, <span class="st">"ESRI:54009"</span>)<span class="sc">$</span>geometry, <span class="at">add =</span> <span class="cn">TRUE</span>,<span class="at">border=</span> <span class="cn">NA</span>, <span class="at">col =</span> <span class="st">"#66666688"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-8-4.png" class="lightbox" data-gallery="quarto-lightbox-gallery-15"><img src="index_files/figure-html/unnamed-chunk-8-4.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Order-level composition per cell?</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>clean_spatial_data <span class="sc">|&gt;</span> </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">case_when</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"DanSelCombined"</span> <span class="sc">~</span> <span class="st">"Danian-Selandian"</span>, T <span class="sc">~</span> Age<span class="fl">.3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">factor</span>(Age<span class="fl">.3</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Campanian"</span>,<span class="st">"Maastrichtian"</span>,<span class="st">"Danian-Selandian"</span>,<span class="st">"Thanetian"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Age<span class="fl">.3</span>,cell,Order) <span class="sc">|&gt;</span> </span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>() <span class="sc">|&gt;</span> </span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cell, <span class="at">y =</span> n, <span class="at">fill =</span> Order)) <span class="sc">+</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>Age<span class="fl">.3</span>,<span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-9-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-16"><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of species per cell?</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>clean_spatial_data <span class="sc">|&gt;</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">case_when</span>(Age<span class="fl">.3</span> <span class="sc">==</span> <span class="st">"DanSelCombined"</span> <span class="sc">~</span> <span class="st">"Danian-Selandian"</span>, T <span class="sc">~</span> Age<span class="fl">.3</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age.3 =</span> <span class="fu">factor</span>(Age<span class="fl">.3</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Campanian"</span>,<span class="st">"Maastrichtian"</span>,<span class="st">"Danian-Selandian"</span>,<span class="st">"Thanetian"</span>))) <span class="sc">|&gt;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Age<span class="fl">.3</span>,cell) <span class="sc">|&gt;</span> </span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n_distinct</span>(Species)) <span class="sc">|&gt;</span> </span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> cell, <span class="at">y =</span> n)) <span class="sc">+</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Number of species per cell"</span>) <span class="sc">+</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>Age<span class="fl">.3</span>,<span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'Age.3'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-9-2.png" class="lightbox" data-gallery="quarto-lightbox-gallery-17"><img src="index_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="subsampling-routine" class="level2" data-number="8">
<h2 data-number="8" class="anchored" data-anchor-id="subsampling-routine"><span class="header-section-number">8</span> Subsampling routine</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>split_by_age <span class="ot">&lt;-</span> <span class="cf">function</span>(data, age) {</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  data <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Age<span class="fl">.3</span> <span class="sc">==</span> age) <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_split</span>(cell_id) <span class="sc">|&gt;</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(as.data.frame)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Data splitting based on cell-ID and stage.</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>campanian_split <span class="ot">&lt;-</span> <span class="fu">split_by_age</span>(<span class="at">data =</span> clean_spatial_data,<span class="at">age =</span> <span class="st">"Campanian"</span>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>maastrichtian_split <span class="ot">&lt;-</span> <span class="fu">split_by_age</span>(<span class="at">data =</span> clean_spatial_data,<span class="at">age =</span> <span class="st">"Maastrichtian"</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>danian_split <span class="ot">&lt;-</span> <span class="fu">split_by_age</span>(<span class="at">data =</span> clean_spatial_data,<span class="at">age =</span> <span class="st">"DanSelCombined"</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>thanetian_split <span class="ot">&lt;-</span> <span class="fu">split_by_age</span>(<span class="at">data =</span> clean_spatial_data,<span class="at">age =</span> <span class="st">"Thanetian"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function.</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>boot_age <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">n_boot =</span> <span class="cn">NULL</span>, <span class="at">n_strata =</span> <span class="cn">NULL</span>, <span class="at">n_per_stratum =</span> <span class="cn">NULL</span>) {</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="dv">1</span><span class="sc">:</span>n_boot, <span class="sc">~</span> {</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">|&gt;</span> <span class="fu">sample</span>(n_strata, <span class="at">replace =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>      purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span> <span class="fu">sample_n</span>(.x, n_per_stratum, <span class="at">replace =</span> <span class="cn">FALSE</span>))</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Campanian</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>boot_campanian <span class="ot">&lt;-</span> <span class="fu">boot_age</span>(<span class="at">x =</span> campanian_split,<span class="at">n_boot =</span> <span class="dv">999</span>,<span class="at">n_strata =</span> <span class="dv">5</span>,<span class="at">n_per_stratum =</span> <span class="dv">15</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Maastrichtian.</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>boot_maastrichtian <span class="ot">&lt;-</span> <span class="fu">boot_age</span>(<span class="at">x =</span> maastrichtian_split,<span class="at">n_boot =</span> <span class="dv">999</span>,<span class="at">n_strata =</span> <span class="dv">5</span>,<span class="at">n_per_stratum =</span> <span class="dv">15</span>)</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Danian-Selandian.</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3</span>)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>boot_danian <span class="ot">&lt;-</span> <span class="fu">boot_age</span>(<span class="at">x =</span> danian_split,<span class="at">n_boot =</span> <span class="dv">999</span>,<span class="at">n_strata =</span> <span class="dv">5</span>,<span class="at">n_per_stratum =</span> <span class="dv">15</span>)</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Thanetian.</span></span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">4</span>)</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>boot_thanetian <span class="ot">&lt;-</span> <span class="fu">boot_age</span>(<span class="at">x =</span> thanetian_split,<span class="at">n_boot =</span> <span class="dv">999</span>,<span class="at">n_strata =</span> <span class="dv">5</span>,<span class="at">n_per_stratum =</span> <span class="dv">15</span>)</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Function.</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>combine_boot_lists <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="fu">length</span>(x))</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(x)) {</span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a>    result[[i]] <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_dfr</span>(x[[i]], bind_rows)</span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>  result</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>combined_cam <span class="ot">&lt;-</span> <span class="fu">combine_boot_lists</span>(<span class="at">x =</span> boot_campanian)</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a>combined_mas <span class="ot">&lt;-</span> <span class="fu">combine_boot_lists</span>(<span class="at">x =</span> boot_maastrichtian)</span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a>combined_dan <span class="ot">&lt;-</span> <span class="fu">combine_boot_lists</span>(<span class="at">x =</span> boot_danian)</span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>combined_tha <span class="ot">&lt;-</span> <span class="fu">combine_boot_lists</span>(<span class="at">x =</span> boot_thanetian)</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Functions.</span></span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>taxa_occurence_cell <span class="ot">&lt;-</span> <span class="cf">function</span>(combined_data) {</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a> purrr<span class="sc">::</span><span class="fu">map</span>(combined_data, <span class="sc">~</span> .x <span class="sc">|&gt;</span> <span class="fu">group_by</span>(cell,Species,Genus) <span class="sc">|&gt;</span> <span class="fu">summarise</span>(<span class="at">occs_species =</span> <span class="fu">n</span>(),<span class="at">occs_genera =</span> <span class="fu">n</span>(), <span class="at">.groups =</span> <span class="st">'drop'</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(as.data.frame) <span class="sc">|&gt;</span> </span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Determine the number of unique cells.</span></span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a>distinct_cells <span class="ot">&lt;-</span> <span class="cf">function</span>(data) {</span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="fu">unique</span>(data<span class="sc">$</span>cell)) <span class="sc">|&gt;</span> <span class="fu">setNames</span>(<span class="at">nm =</span> <span class="st">"x"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">n_part =</span> <span class="fu">as.numeric</span>(<span class="fu">sub</span>(<span class="st">"F"</span>, <span class="st">""</span>, x))) <span class="sc">|&gt;</span> </span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(n_part) <span class="sc">|&gt;</span> </span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(x)</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a>camp_cells <span class="ot">&lt;-</span> <span class="fu">distinct_cells</span>(<span class="at">data =</span> <span class="fu">taxa_occurence_cell</span>(combined_cam))</span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>mass_cells <span class="ot">&lt;-</span> <span class="fu">distinct_cells</span>(<span class="at">data =</span> <span class="fu">taxa_occurence_cell</span>(combined_mas))</span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>dani_cells <span class="ot">&lt;-</span> <span class="fu">distinct_cells</span>(<span class="at">data =</span> <span class="fu">taxa_occurence_cell</span>(combined_dan))</span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>than_cells <span class="ot">&lt;-</span> <span class="fu">distinct_cells</span>(<span class="at">data =</span> <span class="fu">taxa_occurence_cell</span>(combined_tha))</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Distinct cell pairs.</span></span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>cells_distinct_pair <span class="ot">&lt;-</span> <span class="cf">function</span>(data_x1,data_x2) {</span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">expand.grid</span>(data_x1,data_x2,<span class="at">stringsAsFactors =</span> F) <span class="sc">|&gt;</span> </span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">setNames</span>(<span class="at">nm =</span> <span class="fu">c</span>(<span class="st">"x"</span>,<span class="st">"y"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb35-60"><a href="#cb35-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(x<span class="sc">&lt;</span>y) <span class="sc">|&gt;</span> </span>
<span id="cb35-61"><a href="#cb35-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span>
<span id="cb35-62"><a href="#cb35-62" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-63"><a href="#cb35-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-64"><a href="#cb35-64" aria-hidden="true" tabindex="-1"></a>cdp <span class="ot">&lt;-</span> <span class="fu">cells_distinct_pair</span>(<span class="at">data_x1 =</span> camp_cells,<span class="at">data_x2 =</span> camp_cells)</span>
<span id="cb35-65"><a href="#cb35-65" aria-hidden="true" tabindex="-1"></a>mdp <span class="ot">&lt;-</span> <span class="fu">cells_distinct_pair</span>(<span class="at">data_x1 =</span> mass_cells,<span class="at">data_x2 =</span> mass_cells)</span>
<span id="cb35-66"><a href="#cb35-66" aria-hidden="true" tabindex="-1"></a>ddp <span class="ot">&lt;-</span> <span class="fu">cells_distinct_pair</span>(<span class="at">data_x1 =</span> dani_cells,<span class="at">data_x2 =</span> dani_cells)</span>
<span id="cb35-67"><a href="#cb35-67" aria-hidden="true" tabindex="-1"></a>tdp <span class="ot">&lt;-</span> <span class="fu">cells_distinct_pair</span>(<span class="at">data_x1 =</span> than_cells,<span class="at">data_x2 =</span> than_cells)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="jaccard-similarity" class="level2" data-number="9">
<h2 data-number="9" class="anchored" data-anchor-id="jaccard-similarity"><span class="header-section-number">9</span> Jaccard similarity</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>jaccard_similarity <span class="ot">&lt;-</span> <span class="cf">function</span>(x, group_col) {</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  js_table <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (k <span class="cf">in</span> <span class="fu">seq_along</span>(x)) {</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    unique_cells <span class="ot">&lt;-</span> <span class="fu">unique</span>(x[[k]]<span class="sc">$</span>cell)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    jaccard_similarity_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">cell_x =</span> <span class="fu">character</span>(),</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">cell_y =</span> <span class="fu">character</span>(),</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">jaccard_similarity =</span> <span class="fu">numeric</span>(),</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(unique_cells)) {</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>      cell_x <span class="ot">&lt;-</span> unique_cells[i]</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>      unique_names_cell_x <span class="ot">&lt;-</span> <span class="fu">unique</span>(x[[k]][[group_col]][x[[k]]<span class="sc">$</span>cell <span class="sc">==</span> cell_x])</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (j <span class="cf">in</span> <span class="fu">seq_along</span>(unique_cells)) {</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>        cell_y <span class="ot">&lt;-</span> unique_cells[j]</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (cell_x <span class="sc">==</span> cell_y <span class="sc">||</span> cell_x <span class="sc">&gt;</span> cell_y) <span class="cf">next</span></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>        unique_names_cell_y <span class="ot">&lt;-</span> <span class="fu">unique</span>(x[[k]][[group_col]][x[[k]]<span class="sc">$</span>cell <span class="sc">==</span> cell_y])</span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>        intersection <span class="ot">&lt;-</span> <span class="fu">length</span>(generics<span class="sc">::</span><span class="fu">intersect</span>(unique_names_cell_x, unique_names_cell_y))</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>        union_length <span class="ot">&lt;-</span> <span class="fu">length</span>(generics<span class="sc">::</span><span class="fu">union</span>(unique_names_cell_x, unique_names_cell_y))</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>        jaccard_similarity <span class="ot">&lt;-</span> intersection <span class="sc">/</span> union_length</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>        jaccard_similarity_table <span class="ot">&lt;-</span> <span class="fu">rbind</span>(jaccard_similarity_table, <span class="fu">data.frame</span>(</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>          <span class="at">cell_x =</span> cell_x,</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>          <span class="at">cell_y =</span> cell_y,</span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>          <span class="at">jaccard_similarity =</span> jaccard_similarity,</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>          <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>        ))</span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>    js_table[[k]] <span class="ot">&lt;-</span> jaccard_similarity_table </span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(js_table)</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Campanian.</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>cmp_jaccard_species <span class="ot">&lt;-</span> <span class="fu">jaccard_similarity</span>(<span class="at">x =</span> combined_cam,<span class="at">group_col =</span> <span class="st">"Species"</span>)</span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Maastrichtian.</span></span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>mas_jaccard_species <span class="ot">&lt;-</span> <span class="fu">jaccard_similarity</span>(combined_mas,<span class="at">group_col =</span> <span class="st">"Species"</span>)</span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a><span class="co"># Danian/Selandian.</span></span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a>dan_jaccard_species <span class="ot">&lt;-</span> <span class="fu">jaccard_similarity</span>(combined_dan,<span class="at">group_col =</span> <span class="st">"Species"</span>)</span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Thanetian.</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>tha_jaccard_species <span class="ot">&lt;-</span> <span class="fu">jaccard_similarity</span>(combined_tha,<span class="at">group_col =</span> <span class="st">"Species"</span>)</span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Campanian.</span></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>cmp_jaccard_genera <span class="ot">&lt;-</span> <span class="fu">jaccard_similarity</span>(<span class="at">x =</span> combined_cam,<span class="at">group_col =</span> <span class="st">"Genus"</span>)</span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Maastrichtian.</span></span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>mas_jaccard_genera <span class="ot">&lt;-</span> <span class="fu">jaccard_similarity</span>(combined_mas,<span class="at">group_col =</span> <span class="st">"Genus"</span>)</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a><span class="co"># Danian/Selandian.</span></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>dan_jaccard_genera <span class="ot">&lt;-</span> <span class="fu">jaccard_similarity</span>(combined_dan,<span class="at">group_col =</span> <span class="st">"Genus"</span>)</span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Thanetian.</span></span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a>tha_jaccard_genera <span class="ot">&lt;-</span> <span class="fu">jaccard_similarity</span>(combined_tha,<span class="at">group_col =</span> <span class="st">"Genus"</span>)</span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a><span class="co"># Average similarity for each cell-pair and stage.</span></span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>mean_jaccard <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(x) <span class="sc">|&gt;</span></span>
<span id="cb36-65"><a href="#cb36-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cell_x, cell_y) <span class="sc">|&gt;</span> </span>
<span id="cb36-66"><a href="#cb36-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">avg_jaccard =</span> <span class="fu">mean</span>(jaccard_similarity)) <span class="sc">|&gt;</span> </span>
<span id="cb36-67"><a href="#cb36-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"x.cell"</span> <span class="ot">=</span> <span class="st">"cell_x"</span>, <span class="st">"y.cell"</span> <span class="ot">=</span> <span class="st">"cell_y"</span>) </span>
<span id="cb36-68"><a href="#cb36-68" aria-hidden="true" tabindex="-1"></a>  }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="great-circle-distance" class="level2" data-number="10">
<h2 data-number="10" class="anchored" data-anchor-id="great-circle-distance"><span class="header-section-number">10</span> Great Circle Distance</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function.</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>gcd.slc <span class="ot">&lt;-</span> <span class="cf">function</span>(long1, lat1, long2, lat2) {</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  R <span class="ot">&lt;-</span> <span class="dv">6371</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  long1.r <span class="ot">&lt;-</span> long1<span class="sc">*</span>pi<span class="sc">/</span><span class="dv">180</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  long2.r <span class="ot">&lt;-</span> long2<span class="sc">*</span>pi<span class="sc">/</span><span class="dv">180</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  lat1.r <span class="ot">&lt;-</span> lat1<span class="sc">*</span>pi<span class="sc">/</span><span class="dv">180</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  lat2.r <span class="ot">&lt;-</span> lat2<span class="sc">*</span>pi<span class="sc">/</span><span class="dv">180</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  d <span class="ot">&lt;-</span> <span class="fu">acos</span>(<span class="fu">sin</span>(lat1.r)<span class="sc">*</span><span class="fu">sin</span>(lat2.r) <span class="sc">+</span> <span class="fu">cos</span>(lat1.r)<span class="sc">*</span><span class="fu">cos</span>(lat2.r) <span class="sc">*</span> <span class="fu">cos</span>(long2.r<span class="sc">-</span>long1.r)) <span class="sc">*</span> R</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(d) </span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Function.</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>matrix_results <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># X-coordinates.</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(clean_spatial_data <span class="sc">|&gt;</span> <span class="fu">select</span>(cell,long,lat), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"x"</span> <span class="ot">=</span> <span class="st">"cell"</span>),<span class="at">relationship =</span> <span class="st">"many-to-many"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(x,y,long,lat) <span class="sc">|&gt;</span> </span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"x_long"</span> <span class="ot">=</span> <span class="st">"long"</span>,<span class="st">"x_lat"</span> <span class="ot">=</span> <span class="st">"lat"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Y-coordinates.</span></span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(clean_spatial_data <span class="sc">|&gt;</span> <span class="fu">select</span>(cell,long,lat), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"y"</span> <span class="ot">=</span> <span class="st">"cell"</span>),<span class="at">relationship =</span> <span class="st">"many-to-many"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">distinct</span>(x,y,x_long,x_lat,long,lat) <span class="sc">|&gt;</span> </span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename variables.</span></span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"y_long"</span> <span class="ot">=</span> <span class="st">"long"</span>,<span class="st">"y_lat"</span> <span class="ot">=</span> <span class="st">"lat"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># GCD.</span></span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gcd =</span> <span class="fu">gcd.slc</span>(<span class="at">long1 =</span> x_long,<span class="at">lat1 =</span> x_lat,<span class="at">long2 =</span> y_long,<span class="at">lat2 =</span> y_lat)) <span class="sc">|&gt;</span> </span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Pair-wise cells along with corresponding coordinates and GCD.</span></span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>cmp_matrix <span class="ot">&lt;-</span> <span class="fu">matrix_results</span>(<span class="at">x =</span> cdp)</span>
<span id="cb37-31"><a href="#cb37-31" aria-hidden="true" tabindex="-1"></a>mas_matrix <span class="ot">&lt;-</span> <span class="fu">matrix_results</span>(<span class="at">x =</span> mdp)</span>
<span id="cb37-32"><a href="#cb37-32" aria-hidden="true" tabindex="-1"></a>dan_matrix <span class="ot">&lt;-</span> <span class="fu">matrix_results</span>(<span class="at">x =</span> ddp)</span>
<span id="cb37-33"><a href="#cb37-33" aria-hidden="true" tabindex="-1"></a>tha_matrix <span class="ot">&lt;-</span> <span class="fu">matrix_results</span>(<span class="at">x =</span> tdp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="visualize-results" class="level2" data-number="11">
<h2 data-number="11" class="anchored" data-anchor-id="visualize-results"><span class="header-section-number">11</span> Visualize results</h2>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function.</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>adjust_matrix <span class="ot">&lt;-</span> <span class="cf">function</span>(x,y) {</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"x.cell"</span> <span class="ot">=</span> <span class="st">"x"</span>,<span class="st">"y.cell"</span> <span class="ot">=</span> <span class="st">"y"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(y,<span class="at">by =</span> <span class="fu">c</span>(<span class="st">"x.cell"</span>,<span class="st">"y.cell"</span>)) </span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>cmp_species_input <span class="ot">&lt;-</span> <span class="fu">adjust_matrix</span>(<span class="at">x =</span> cmp_matrix,<span class="at">y =</span> <span class="fu">mean_jaccard</span>(<span class="at">x =</span> cmp_jaccard_species))</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>mas_species_input <span class="ot">&lt;-</span> <span class="fu">adjust_matrix</span>(<span class="at">x =</span> mas_matrix,<span class="at">y =</span> <span class="fu">mean_jaccard</span>(<span class="at">x =</span> mas_jaccard_species))</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>dan_species_input <span class="ot">&lt;-</span> <span class="fu">adjust_matrix</span>(<span class="at">x =</span> dan_matrix,<span class="at">y =</span> <span class="fu">mean_jaccard</span>(<span class="at">x =</span> dan_jaccard_species))</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>tha_species_input <span class="ot">&lt;-</span> <span class="fu">adjust_matrix</span>(<span class="at">x =</span> tha_matrix,<span class="at">y =</span> <span class="fu">mean_jaccard</span>(<span class="at">x =</span> tha_jaccard_species))</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>cmp_genera_input <span class="ot">&lt;-</span> <span class="fu">adjust_matrix</span>(<span class="at">x =</span> cmp_matrix,<span class="at">y =</span> <span class="fu">mean_jaccard</span>(<span class="at">x =</span> cmp_jaccard_genera))</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>mas_genera_input <span class="ot">&lt;-</span> <span class="fu">adjust_matrix</span>(<span class="at">x =</span> mas_matrix,<span class="at">y =</span> <span class="fu">mean_jaccard</span>(<span class="at">x =</span> mas_jaccard_genera))</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>dan_genera_input <span class="ot">&lt;-</span> <span class="fu">adjust_matrix</span>(<span class="at">x =</span> dan_matrix,<span class="at">y =</span> <span class="fu">mean_jaccard</span>(<span class="at">x =</span> dan_jaccard_genera))</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>tha_genera_input <span class="ot">&lt;-</span> <span class="fu">adjust_matrix</span>(<span class="at">x =</span> tha_matrix,<span class="at">y =</span> <span class="fu">mean_jaccard</span>(<span class="at">x =</span> tha_jaccard_genera))</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Function.</span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>add_cutdist<span class="ot">&lt;-</span> <span class="cf">function</span>(df, <span class="at">new_col =</span> <span class="st">"gcd"</span>) {</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>cutdist <span class="ot">&lt;-</span> <span class="fu">cut</span>(df[[new_col]],</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>                    <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2000</span>, <span class="dv">4000</span>, <span class="dv">6000</span>, <span class="dv">8000</span>, <span class="dv">10000</span>, <span class="dv">12000</span>, </span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>                               <span class="dv">14000</span>, <span class="dv">16000</span>, <span class="dv">18000</span>, <span class="dv">20000</span>), </span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>                    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"2000"</span>, <span class="st">"4000"</span>, <span class="st">"6000"</span>, <span class="st">"8000"</span>, </span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"10000"</span>, <span class="st">"12000"</span>, <span class="st">"14000"</span>, <span class="st">"16000"</span>, <span class="st">"18000"</span>),</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a>                    <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb38-27"><a href="#cb38-27" aria-hidden="true" tabindex="-1"></a>} <span class="co"># Bin by distance between cells (GCD in km's)</span></span>
<span id="cb38-28"><a href="#cb38-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-29"><a href="#cb38-29" aria-hidden="true" tabindex="-1"></a>cmp_species_binned <span class="ot">&lt;-</span> <span class="fu">add_cutdist</span>(<span class="at">df =</span> cmp_species_input,<span class="at">new_col =</span> <span class="st">"gcd"</span>)</span>
<span id="cb38-30"><a href="#cb38-30" aria-hidden="true" tabindex="-1"></a>mas_species_binned <span class="ot">&lt;-</span> <span class="fu">add_cutdist</span>(<span class="at">df =</span> mas_species_input,<span class="at">new_col =</span> <span class="st">"gcd"</span>)</span>
<span id="cb38-31"><a href="#cb38-31" aria-hidden="true" tabindex="-1"></a>dan_species_binned <span class="ot">&lt;-</span> <span class="fu">add_cutdist</span>(<span class="at">df =</span> dan_species_input,<span class="at">new_col =</span> <span class="st">"gcd"</span>)</span>
<span id="cb38-32"><a href="#cb38-32" aria-hidden="true" tabindex="-1"></a>tha_species_binned <span class="ot">&lt;-</span> <span class="fu">add_cutdist</span>(<span class="at">df =</span> tha_species_input,<span class="at">new_col =</span> <span class="st">"gcd"</span>)</span>
<span id="cb38-33"><a href="#cb38-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-34"><a href="#cb38-34" aria-hidden="true" tabindex="-1"></a>cmp_genera_binned <span class="ot">&lt;-</span> <span class="fu">add_cutdist</span>(<span class="at">df =</span> cmp_genera_input,<span class="at">new_col =</span> <span class="st">"gcd"</span>)</span>
<span id="cb38-35"><a href="#cb38-35" aria-hidden="true" tabindex="-1"></a>mas_genera_binned <span class="ot">&lt;-</span> <span class="fu">add_cutdist</span>(<span class="at">df =</span> mas_genera_input,<span class="at">new_col =</span> <span class="st">"gcd"</span>)</span>
<span id="cb38-36"><a href="#cb38-36" aria-hidden="true" tabindex="-1"></a>dan_genera_binned <span class="ot">&lt;-</span> <span class="fu">add_cutdist</span>(<span class="at">df =</span> dan_genera_input,<span class="at">new_col =</span> <span class="st">"gcd"</span>)</span>
<span id="cb38-37"><a href="#cb38-37" aria-hidden="true" tabindex="-1"></a>tha_genera_binned <span class="ot">&lt;-</span> <span class="fu">add_cutdist</span>(<span class="at">df =</span> tha_genera_input,<span class="at">new_col =</span> <span class="st">"gcd"</span>)</span>
<span id="cb38-38"><a href="#cb38-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-39"><a href="#cb38-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Function (average and standard deviation).</span></span>
<span id="cb38-40"><a href="#cb38-40" aria-hidden="true" tabindex="-1"></a>summary_statistics <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb38-41"><a href="#cb38-41" aria-hidden="true" tabindex="-1"></a>  x <span class="sc">|&gt;</span> </span>
<span id="cb38-42"><a href="#cb38-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cutdist) <span class="sc">|&gt;</span> </span>
<span id="cb38-43"><a href="#cb38-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb38-44"><a href="#cb38-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Jaccard.</span></span>
<span id="cb38-45"><a href="#cb38-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">avg =</span>  <span class="fu">mean</span>(avg_jaccard, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-46"><a href="#cb38-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">sdev =</span> <span class="fu">sd</span>(avg_jaccard, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-47"><a href="#cb38-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>(),</span>
<span id="cb38-48"><a href="#cb38-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">se =</span> sdev<span class="sc">/</span><span class="fu">sqrt</span>(n),</span>
<span id="cb38-49"><a href="#cb38-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Quantiles.</span></span>
<span id="cb38-50"><a href="#cb38-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">first =</span>  <span class="fu">quantile</span>(avg_jaccard,<span class="at">probs=</span><span class="fl">0.05</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb38-51"><a href="#cb38-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">second =</span> <span class="fu">quantile</span>(avg_jaccard,<span class="at">probs=</span><span class="fl">0.95</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb38-52"><a href="#cb38-52" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb38-53"><a href="#cb38-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cutdist =</span> cutdist,</span>
<span id="cb38-54"><a href="#cb38-54" aria-hidden="true" tabindex="-1"></a>         <span class="at">cutdist =</span> <span class="fu">factor</span>(cutdist,<span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"2000"</span>,<span class="st">"4000"</span>,<span class="st">"6000"</span>,<span class="st">"8000"</span>,<span class="st">"10000"</span>,<span class="st">"12000"</span>,<span class="st">"14000"</span>,<span class="st">"16000"</span>,<span class="st">"18000"</span>,<span class="st">"20000"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb38-55"><a href="#cb38-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ci =</span> se <span class="sc">*</span> <span class="fu">qt</span>(.<span class="dv">95</span>, n <span class="sc">-</span> <span class="dv">1</span>), <span class="at">ci =</span> <span class="fu">as.numeric</span>(ci)) <span class="sc">|&gt;</span> </span>
<span id="cb38-56"><a href="#cb38-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">suppressWarnings</span>() </span>
<span id="cb38-57"><a href="#cb38-57" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-58"><a href="#cb38-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-59"><a href="#cb38-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Species-level analysis.</span></span>
<span id="cb38-60"><a href="#cb38-60" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> </span>
<span id="cb38-61"><a href="#cb38-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb38-62"><a href="#cb38-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary_statistics</span>(<span class="at">x =</span> cmp_species_binned) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">label =</span> <span class="st">"Campanian"</span>),</span>
<span id="cb38-63"><a href="#cb38-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary_statistics</span>(<span class="at">x =</span> mas_species_binned) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">label =</span> <span class="st">"Maastrichtian"</span>),</span>
<span id="cb38-64"><a href="#cb38-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary_statistics</span>(<span class="at">x =</span> dan_species_binned) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">label =</span> <span class="st">"Danian"</span>),</span>
<span id="cb38-65"><a href="#cb38-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary_statistics</span>(<span class="at">x =</span> tha_species_binned) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">label =</span> <span class="st">"Thanetian"</span>)</span>
<span id="cb38-66"><a href="#cb38-66" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb38-67"><a href="#cb38-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">factor</span>(label, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Campanian"</span>,<span class="st">"Maastrichtian"</span>,<span class="st">"Danian"</span>,<span class="st">"Thanetian"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb38-68"><a href="#cb38-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot.</span></span>
<span id="cb38-69"><a href="#cb38-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutdist, <span class="at">y =</span> avg, <span class="at">group =</span> label, <span class="at">colour =</span> label, <span class="at">fill =</span> label)) <span class="sc">+</span></span>
<span id="cb38-70"><a href="#cb38-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> second, <span class="at">ymax =</span> first), <span class="at">width =</span> <span class="fl">0.05</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.3</span>)) <span class="sc">+</span> </span>
<span id="cb38-71"><a href="#cb38-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.3</span>)) <span class="sc">+</span></span>
<span id="cb38-72"><a href="#cb38-72" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_size_continuous(breaks = c(5, 10, 15, 20, 25, 30)) +</span></span>
<span id="cb38-73"><a href="#cb38-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span>   <span class="fu">c</span>(<span class="st">"#C1C6CFFF"</span>,<span class="st">"#180C18FF"</span>,<span class="st">"#933450FF"</span>,<span class="st">"#D99755FF"</span>)) <span class="sc">+</span></span>
<span id="cb38-74"><a href="#cb38-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#C1C6CFFF"</span>,<span class="st">"#180C18FF"</span>,<span class="st">"#933450FF"</span>,<span class="st">"#D99755FF"</span>)) <span class="sc">+</span></span>
<span id="cb38-75"><a href="#cb38-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n),<span class="at">shape =</span> <span class="dv">21</span>,<span class="at">fill =</span> <span class="st">"white"</span>,<span class="at">stroke =</span> <span class="fl">1.5</span>,<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.3</span>)) <span class="sc">+</span></span>
<span id="cb38-76"><a href="#cb38-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Great Circle Distance (km)"</span>, </span>
<span id="cb38-77"><a href="#cb38-77" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Similarity Value"</span>,</span>
<span id="cb38-78"><a href="#cb38-78" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Species-level assessment"</span>,</span>
<span id="cb38-79"><a href="#cb38-79" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Subsampling by cells and occurrences"</span>, <span class="at">colour =</span> <span class="st">"Stages"</span>, <span class="at">size =</span> <span class="st">"Cell-pair comparison"</span>) <span class="sc">+</span></span>
<span id="cb38-80"><a href="#cb38-80" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb38-81"><a href="#cb38-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb38-82"><a href="#cb38-82" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb38-83"><a href="#cb38-83" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb38-84"><a href="#cb38-84" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb38-85"><a href="#cb38-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-86"><a href="#cb38-86" aria-hidden="true" tabindex="-1"></a><span class="co"># Genus-level analysis.</span></span>
<span id="cb38-87"><a href="#cb38-87" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> </span>
<span id="cb38-88"><a href="#cb38-88" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(</span>
<span id="cb38-89"><a href="#cb38-89" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary_statistics</span>(<span class="at">x =</span> cmp_genera_binned) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">label =</span> <span class="st">"Campanian"</span>),</span>
<span id="cb38-90"><a href="#cb38-90" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary_statistics</span>(<span class="at">x =</span> mas_genera_binned) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">label =</span> <span class="st">"Maastrichtian"</span>),</span>
<span id="cb38-91"><a href="#cb38-91" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary_statistics</span>(<span class="at">x =</span> dan_genera_binned) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">label =</span> <span class="st">"Danian"</span>),</span>
<span id="cb38-92"><a href="#cb38-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary_statistics</span>(<span class="at">x =</span> tha_genera_binned) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">label =</span> <span class="st">"Thanetian"</span>)</span>
<span id="cb38-93"><a href="#cb38-93" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb38-94"><a href="#cb38-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">label =</span> <span class="fu">factor</span>(label, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Campanian"</span>,<span class="st">"Maastrichtian"</span>,<span class="st">"Danian"</span>,<span class="st">"Thanetian"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb38-95"><a href="#cb38-95" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot.</span></span>
<span id="cb38-96"><a href="#cb38-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> cutdist, <span class="at">y =</span> avg, <span class="at">group =</span> label, <span class="at">colour =</span> label, <span class="at">fill =</span> label)) <span class="sc">+</span></span>
<span id="cb38-97"><a href="#cb38-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> second, <span class="at">ymax =</span> first), <span class="at">width =</span> <span class="fl">0.05</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.3</span>)) <span class="sc">+</span> </span>
<span id="cb38-98"><a href="#cb38-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.3</span>)) <span class="sc">+</span></span>
<span id="cb38-99"><a href="#cb38-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span>   <span class="fu">c</span>(<span class="st">"#C1C6CFFF"</span>,<span class="st">"#180C18FF"</span>,<span class="st">"#933450FF"</span>,<span class="st">"#D99755FF"</span>)) <span class="sc">+</span></span>
<span id="cb38-100"><a href="#cb38-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#C1C6CFFF"</span>,<span class="st">"#180C18FF"</span>,<span class="st">"#933450FF"</span>,<span class="st">"#D99755FF"</span>)) <span class="sc">+</span></span>
<span id="cb38-101"><a href="#cb38-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> n),<span class="at">shape =</span> <span class="dv">21</span>,<span class="at">fill =</span> <span class="st">"white"</span>,<span class="at">stroke =</span> <span class="fl">1.5</span>,<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.3</span>)) <span class="sc">+</span></span>
<span id="cb38-102"><a href="#cb38-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Great Circle Distance (km)"</span>, </span>
<span id="cb38-103"><a href="#cb38-103" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Similarity Value"</span>,</span>
<span id="cb38-104"><a href="#cb38-104" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Genus-level assessment"</span>,</span>
<span id="cb38-105"><a href="#cb38-105" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Subsampling by cells and occurrences"</span>, <span class="at">colour =</span> <span class="st">"Stages"</span>, <span class="at">size =</span> <span class="st">"Cell-pair comparison"</span>) <span class="sc">+</span></span>
<span id="cb38-106"><a href="#cb38-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>() <span class="sc">+</span></span>
<span id="cb38-107"><a href="#cb38-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb38-108"><a href="#cb38-108" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb38-109"><a href="#cb38-109" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb38-110"><a href="#cb38-110" aria-hidden="true" tabindex="-1"></a>        <span class="at">aspect.ratio =</span> <span class="dv">1</span>)</span>
<span id="cb38-111"><a href="#cb38-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-112"><a href="#cb38-112" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(p1,p2,<span class="at">ncol =</span> <span class="dv">2</span>,<span class="at">align =</span> <span class="st">"hv"</span>,<span class="at">common.legend =</span> T,<span class="at">legend =</span> <span class="st">"right"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><a href="index_files/figure-html/unnamed-chunk-14-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-18"><img src="index_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>